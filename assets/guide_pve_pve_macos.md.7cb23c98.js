import{_ as a,v as p,b as o,R as l}from"./chunks/framework.70afa331.js";const s="/assets/mac0.935d53f3.png",n="/assets/mac1.3307e401.png",e="/assets/mac2.da6ce0bc.png",t="/assets/mac3.76a50b9f.png",c="/assets/mac4.c341ba50.png",r="/assets/mac5.39e1c9a4.png",i="/assets/mac6.1cc0462b.png",C="/assets/mac7.181275ae.png",d="/assets/mac8.dd556f02.png",m="/assets/mac9.c5d88eba.png",y="/assets/mac10.e9c284db.png",h="/assets/mac11.a7587e0e.png",A="/assets/mac12.06b051d3.png",D="/assets/mac13.7d4e3199.png",g="/assets/mac14.39a58b6a.png",u="/assets/mac15.f151793c.png",_="/assets/mac16.eae177db.png",b="/assets/mac17.be61913a.png",F="/assets/mac18.f9454618.png",v="/assets/mac19.845f5510.png",B="/assets/mac20.49a5800c.png",E="/assets/mac21.2c30b60f.png",O=JSON.parse('{"title":"开设MacOS虚拟机","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"guide/pve/pve_macos.md","filePath":"guide/pve/pve_macos.md","lastUpdated":1746712940000}'),f={name:"guide/pve/pve_macos.md"},k=l(`<h1 id="开设macos虚拟机" tabindex="-1">开设MacOS虚拟机 <a class="header-anchor" href="#开设macos虚拟机" aria-label="Permalink to &quot;开设MacOS虚拟机&quot;">​</a></h1><h2 id="前置需求" tabindex="-1">前置需求 <a class="header-anchor" href="#前置需求" aria-label="Permalink to &quot;前置需求&quot;">​</a></h2><p>系统和硬件配置要求 --&gt; 检测环境</p><p>只有检测环境检测出宿主机支持KVM嵌套虚拟化时，才可以开设MACOS虚拟机，否则会被硬件识别无法开设。</p><h2 id="前置环境设置" tabindex="-1">前置环境设置 <a class="header-anchor" href="#前置环境设置" aria-label="Permalink to &quot;前置环境设置&quot;">​</a></h2><ul><li>自动识别 CPU 类型（AMD 或 Intel），并根据类型设置嵌套虚拟化参数。</li><li>修改 GRUB 启动参数，启用 IOMMU 和禁用默认 framebuffer。</li><li>添加 VFIO 模块支持，便于直通硬件设备。</li><li>黑名单声卡和显卡驱动模块，避免与 macOS 冲突。</li><li>配置 KVM 相关内核参数，忽略 MSR 错误，提高兼容性。</li><li>修补 Proxmox 前端状态检测逻辑，绕过状态限制。</li></ul><p>国际</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/oneclickvirt/pve/main/extra_scripts/configure_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configure_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configure_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configure_macos.sh</span></span></code></pre></div><p>国内</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://cdn.spiritlhl.net/https://raw.githubusercontent.com/oneclickvirt/pve/main/extra_scripts/configure_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configure_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configure_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configure_macos.sh</span></span></code></pre></div><p>执行成功后会显示15秒后重启本机，这是正常的流程，不重启无法使得内核参数生效。</p><h2 id="系统镜像下载" tabindex="-1">系统镜像下载 <a class="header-anchor" href="#系统镜像下载" aria-label="Permalink to &quot;系统镜像下载&quot;">​</a></h2><ul><li>所有镜像已预装组件，体积较大（最小约4.9GB），下载与解压任务将后台挂起执行。</li><li>镜像为完整系统含所有组件，无需联网即可引导使用。</li><li>若系统盘空闲空间不足镜像大小的2倍，将拒绝下载。</li><li>镜像为7z压缩格式，下载后需解压才能使用。</li><li>可随时查看当前下载与解压任务状态，完成后方可创建虚拟机。</li></ul><p>国际</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/oneclickvirt/pve/main/scripts/install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span></span></code></pre></div><p>国内</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://cdn.spiritlhl.net/https://raw.githubusercontent.com/oneclickvirt/pve/main/scripts/install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span></span></code></pre></div><p>或</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span></span></code></pre></div><p>后台下载任务挂起执行后，可关闭SSH窗口，等待半小时到3个小时(具体等待时间取决于你的服务器带宽大小和连通性)，下载iso的7z压缩包。</p><p>下载任务执行完毕后，查询显示当前下载任务为空时，就可以选择解压任务执行了，解压挂起执行等待的时间取决于你的服务器CPU性能。</p><p>当解压任务执行完毕，查询显示当前解压任务为空时，一切准备工作就算准备好了。</p><p>相同类型的任务可以并发，也可以随时取消某个任务，取消时需要输入PID的值。</p><p>目前支持的镜像压缩包：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># 按系统发布时间从旧到新</span></span>
<span class="line"><span style="color:#A6ACCD;">high-sierra.iso.7z (大小: 5.23GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">mojave.iso.7z (大小: 6.03GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">catalina.iso.7z (大小: 8.33GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">big‑sur.iso.7z (大小: 12.21GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">monterey.iso.7z (大小: 12.36GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">ventura.iso.7z (大小: 12.31GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">sonoma.iso.7z (大小: 14.41GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">sequoia.iso.7z (大小: 15.02GB)</span></span></code></pre></div><h2 id="macos虚拟机模板设置" tabindex="-1">MACOS虚拟机模板设置 <a class="header-anchor" href="#macos虚拟机模板设置" aria-label="Permalink to &quot;MACOS虚拟机模板设置&quot;">​</a></h2><ul><li><code>big‑sur</code>及更新版本的MACOS系统需要至少6核6G内存50G硬盘进行开设，系统版本越新(下载的序号越靠后)所需的硬件就越多</li><li>所有镜像均为启动盘镜像，未设置任何个人数据，所以关于硬盘分配，登录信息设置，网络设置都需要后续按照说明手动设置</li><li>需要手动在web端启动虚拟机，启动前可以查看所有模板是否符合预期再启动</li></ul><h3 id="下载模板脚本" tabindex="-1">下载模板脚本 <a class="header-anchor" href="#下载模板脚本" aria-label="Permalink to &quot;下载模板脚本&quot;">​</a></h3><p>国际</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/oneclickvirt/pve/main/scripts/build_macos_vm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build_macos_vm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build_macos_vm.sh</span></span></code></pre></div><p>国内</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://cdn.spiritlhl.net/https://raw.githubusercontent.com/oneclickvirt/pve/main/scripts/build_macos_vm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build_macos_vm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">build_macos_vm.sh</span></span></code></pre></div><h3 id="参数含义" tabindex="-1">参数含义 <a class="header-anchor" href="#参数含义" aria-label="Permalink to &quot;参数含义&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ./build_macos_vm.sh VMID CPU核数 内存 硬盘 SSH端口 VNC端口 系统 存储盘 独立IPV6(留空默认N)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>这块的硬盘大小只是你开设的虚拟机的硬盘大小，实际开设过程中，程序还会挂载引导盘和系统镜像，所以实际开设一个虚拟机的硬盘需求是 虚拟机硬盘大小+镜像本体大小+引导盘大小(500MB) 请时刻注意你的硬盘空间是否足够开设虚拟机</p></div><h3 id="示例命令" tabindex="-1">示例命令 <a class="header-anchor" href="#示例命令" aria-label="Permalink to &quot;示例命令&quot;">​</a></h3><p>以最旧的版本(high-sierra)为例，实验支持的配置如下(非常卡顿)</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./build_macos_vm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4096</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">44022</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">45901</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">high-sierra</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">local</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">N</span></span></code></pre></div><p>模板开设完毕可执行<code>cat vm100</code>查看信息，或到WEB端对应VM的NOTES中查看</p><p>以下为开设的示例VM的信息：</p><table><thead><tr><th>属性</th><th>值</th></tr></thead><tbody><tr><td>VMID</td><td>100</td></tr><tr><td>CPU核数</td><td>2</td></tr><tr><td>内存大小</td><td>4096MB</td></tr><tr><td>磁盘大小</td><td>45G</td></tr><tr><td>SSH端口</td><td>44022</td></tr><tr><td>VNC端口</td><td>45901</td></tr><tr><td>系统</td><td>high-sierra</td></tr><tr><td>宿主机的存储盘</td><td>local</td></tr><tr><td>绑定独立IPV6(留空默认N)</td><td>N</td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>注意这里的VMID仅可使用100到256，其他数字不可用</p></div><h2 id="macos系统引导和安装" tabindex="-1">MACOS系统引导和安装 <a class="header-anchor" href="#macos系统引导和安装" aria-label="Permalink to &quot;MACOS系统引导和安装&quot;">​</a></h2><p>前面的流程走完后，面板端可以看到一个灰色的虚拟机待启动</p><p><img src="`+s+'" alt="mac0"></p><p>点击启动后，进入VNC面板，左侧选择框有一个全屏按钮，实际操作时建议全屏操作，避免分辨率问题</p><p><img src="'+s+'" alt="mac00"></p><p>经过大概3分钟的引导盘加载后，屏幕中央靠左侧会显示有一个启动盘可用，直接点击或回车</p><p>然后又是大概3~5分钟的启动盘加载后，会出现四个选择框，选择<code>Disk Utility</code>点击进入</p><p><img src="'+n+'" alt="mac1"></p><p>进入后可以看到有三个盘和一个镜像，找到那个盘大小大于40G且名字叫<code>QEMU HARDDISK Media</code>的盘，点击<code>Erase</code></p><p><img src="'+e+'" alt="mac2"></p><p>此时会出现一个弹窗，需要给<code>name</code>重命名为<code>macos</code>方便后续识别使用，然后点击<code>Erase</code>继续初始化</p><p><img src="'+t+'" alt="mac3"></p><p>初始化完毕后，点击<code>Done</code></p><p><img src="'+c+'" alt="mac4"></p><p>此时需要退出<code>Disk Utility</code>界面，右上角点击<code>Disk Utility</code>选择<code>Quit Disk Utility</code>退出当前选择框</p><p><img src="'+r+'" alt="mac5"></p><p>然后回到了之前那四个选择框那里，选择<code>Install macOS XXXX</code>(由于我在以Big Sur为示例安装，所以XXXX为Big Sur系统)，点击<code>continue</code></p><p><img src="'+i+'" alt="mac6"></p><p>后续就是继续点击<code>continue</code>，然后点击<code>Agree</code>，然后又是点击<code>Agree</code></p><p><img src="'+C+'" alt="mac7"></p><p><img src="'+d+'" alt="mac8"></p><p><img src="'+m+'" alt="mac9"></p><p>直到又出现那三个盘，但在这块可以那个盘大小大于40G且名字叫<code>macos</code>的盘，选择它，然后点击<code>continue</code></p><p><img src="'+y+'" alt="mac10"></p><p>一段时间的文件复制硬盘加载(大概跑个12分钟)后，正式进入系统安装环节，这块看你宿主机在哪个地区选哪个</p><p><img src="'+h+'" alt="mac11"></p><p>选择完地区后一路点击<code>continue</code></p><p><img src="'+A+'" alt="mac12"></p><p><img src="'+D+'" alt="mac13"></p><p>直到出现数据迁移选项<code>Migration Assistant</code>，选择左下角的<code>Not Now</code>不导入用户数据</p><p><img src="'+g+'" alt="mac14"></p><p>然后就会提示你创建用户，填写用户名和账户名，还有登录所需的密码，设置完毕后点击<code>continue</code></p><p><img src="'+u+'" alt="mac15"></p><p>然后后面就会一路畅通点击<code>continue</code>，直到系统安装完毕了</p><h2 id="网络配置" tabindex="-1">网络配置 <a class="header-anchor" href="#网络配置" aria-label="Permalink to &quot;网络配置&quot;">​</a></h2><p>由于是离线环境进行的系统安装，所以这块需要手动配置静态网络连接宿主机的网桥</p><p>右上角点击WIFI按钮，关闭WIFI后，点击<code>Network Preferences ...</code></p><p><img src="'+_+'" alt="mac16"></p><p>进入设置界面后，点击<code>Advanced</code>按钮，进入高级设置界面</p><p><img src="'+b+'" alt="mac17"></p><p>在<code>TCP/IP</code>这一栏填写静态网络配置</p><p>Configure IPV4: <code>Manually</code></p><p>IPV4 Address: <code>172.16.1.xxx</code>(xxx换成你想绑定的ip，我的vmid是100，为了方便写了100)</p><p>Subnet Mask: <code>255.255.255.0</code></p><p>Router: <code>172.16.1.1</code></p><p>如果你需要配置IPV6网络，类比上面的IPV4设置，需要填写的会是虚拟机绑定的公网IPV6地址(PVE面板中的Note框有写)，子网掩码填128，默认网关填写<code>cat /usr/local/bin/pve_check_ipv6</code>在宿主机执行后显示的地址。</p><p><img src="'+F+'" alt="mac18"></p><p>在<code>DNS</code>这一栏填写静态网络的DNS配置</p><p>一般加入<code>8.8.8.8</code>和<code>1.1.1.1</code>足够了，中国境内使用<code>114.114.114.114</code>即可。</p><p><img src="'+v+'" alt="mac19"></p><p>填写完毕且<code>apply</code>后，设置的左上角会显示网络已连通</p><p><img src="'+B+'" alt="mac20"></p><p>此时打开默认的浏览器，随便打开一个网址，都是可访问公网资源的，证明网络已配置成功</p><p><img src="'+E+'" alt="mac21"></p>',96),P=[k];function x(M,S,I,q,V,G){return p(),o("div",null,P)}const U=a(f,[["render",x]]);export{O as __pageData,U as default};
