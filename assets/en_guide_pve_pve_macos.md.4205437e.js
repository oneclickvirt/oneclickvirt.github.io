import{_ as e,v as a,b as s,R as t}from"./chunks/framework.70afa331.js";import{_ as o}from"./chunks/wk7.776871bd.js";const n="/assets/mac0.935d53f3.png",i="/assets/mac00.4296be7b.png",l="/assets/mac1.3307e401.png",c="/assets/mac2.da6ce0bc.png",r="/assets/mac3.76a50b9f.png",p="/assets/mac4.c341ba50.png",d="/assets/mac5.39e1c9a4.png",m="/assets/mac6.1cc0462b.png",h="/assets/mac7.181275ae.png",u="/assets/mac8.dd556f02.png",y="/assets/mac9.c5d88eba.png",g="/assets/mac10.e9c284db.png",C="/assets/mac11.a7587e0e.png",f="/assets/mac12.06b051d3.png",b="/assets/mac13.7d4e3199.png",A="/assets/mac14.39a58b6a.png",k="/assets/mac15.f151793c.png",D="/assets/mac16.eae177db.png",w="/assets/mac17.be61913a.png",v="/assets/mac18.f9454618.png",_="/assets/mac19.845f5510.png",S="/assets/mac20.49a5800c.png",N=JSON.parse('{"title":"Setting Up MacOS Virtual Machine","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"en/guide/pve/pve_macos.md","filePath":"en/guide/pve/pve_macos.md","lastUpdated":1747706122000}'),x={name:"en/guide/pve/pve_macos.md"},F=t(`<h1 id="setting-up-macos-virtual-machine" tabindex="-1">Setting Up MacOS Virtual Machine <a class="header-anchor" href="#setting-up-macos-virtual-machine" aria-label="Permalink to &quot;Setting Up MacOS Virtual Machine&quot;">​</a></h1><h2 id="prerequisites" tabindex="-1">Prerequisites <a class="header-anchor" href="#prerequisites" aria-label="Permalink to &quot;Prerequisites&quot;">​</a></h2><p>System and hardware configuration requirements --&gt; Environment detection</p><p>You can only set up a MacOS virtual machine when the environment detection confirms that the host machine supports KVM nested virtualization. Otherwise, it will be detected by hardware and cannot be set up.</p><h2 id="setting-up-the-prerequisites" tabindex="-1">Setting Up the Prerequisites <a class="header-anchor" href="#setting-up-the-prerequisites" aria-label="Permalink to &quot;Setting Up the Prerequisites&quot;">​</a></h2><ul><li>Automatically identify CPU type (AMD or Intel) and set nested virtualization parameters according to the type.</li><li>Modify GRUB boot parameters to enable IOMMU and disable default framebuffer.</li><li>Add VFIO module support for hardware device passthrough.</li><li>Blacklist sound card and graphics card driver modules to avoid conflicts with macOS.</li><li>Configure KVM-related kernel parameters, ignore MSR errors, and improve compatibility.</li><li>Patch Proxmox frontend status detection logic to bypass status restrictions.</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/oneclickvirt/pve/main/extra_scripts/configure_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configure_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configure_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">configure_macos.sh</span></span></code></pre></div><p>After successful execution, it will show that the system will restart in 15 seconds. This is the normal process, as kernel parameters cannot take effect without restarting.</p><h2 id="system-image-download" tabindex="-1">System Image Download <a class="header-anchor" href="#system-image-download" aria-label="Permalink to &quot;System Image Download&quot;">​</a></h2><ul><li>All images have pre-installed components and are relatively large (minimum about 4.9GB). Download and extraction tasks will run in the background.</li><li>Images are complete systems with all components and can be booted and used without internet connection.</li><li>If the free space on the system disk is less than twice the size of the image, the download will be rejected.</li><li>Images are in 7z compressed format and need to be extracted before use.</li><li>You can check the status of current download and extraction tasks at any time. Virtual machines can only be created after completion.</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/oneclickvirt/pve/main/scripts/install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--lang=en</span></span></code></pre></div><p>Or</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">install_macos_images.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">--lang=en</span></span></code></pre></div><p>After the background download task starts, you can close the SSH window and wait for 30 minutes to 3 hours (depending on your server bandwidth and connectivity) to download the ISO 7z compressed package.</p><p>When the download task is complete and the current download task query shows empty, you can choose to execute the extraction task. The waiting time for extraction depends on your server&#39;s CPU performance.</p><p>When the extraction task is complete and the current extraction task query shows empty, all preparations are ready.</p><p>Tasks of the same type can run concurrently, and any task can be canceled at any time by entering the PID value.</p><p>Build from <a href="https://github.com/oneclickvirt/macos" target="_blank" rel="noreferrer">https://github.com/oneclickvirt/macos</a> currently supported image compressed packages:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;"># Listed by system release date from old to new</span></span>
<span class="line"><span style="color:#A6ACCD;">high-sierra.iso.7z (Size: 5.23GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">mojave.iso.7z (Size: 6.03GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">catalina.iso.7z (Size: 8.33GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">big‑sur.iso.7z (Size: 12.21GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">monterey.iso.7z (Size: 12.36GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">ventura.iso.7z (Size: 12.31GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">sonoma.iso.7z (Size: 14.41GB)</span></span>
<span class="line"><span style="color:#A6ACCD;">sequoia.iso.7z (Size: 15.02GB)</span></span></code></pre></div><h2 id="macos-virtual-machine-template-setup" tabindex="-1">MACOS Virtual Machine Template Setup <a class="header-anchor" href="#macos-virtual-machine-template-setup" aria-label="Permalink to &quot;MACOS Virtual Machine Template Setup&quot;">​</a></h2><ul><li>Systems <code>high-sierra</code>, <code>mojave</code>, <code>catalina</code> require at least 2 cores, 4G of RAM and 40G of hard disk to run.</li><li><code>big-sur</code> and newer MACOS systems require at least 6 cores, 6G RAM and 50G hard disk.</li><li>The newer the version of the system (the later the serial number of the download), the more hardware is required.</li><li>All images are boot disk images without any personal data, so disk allocation, login information setup, and network settings need to be manually configured according to the instructions.</li><li>You need to manually start the virtual machine from the web interface. Before starting, you can check if all templates meet your expectations.</li></ul><h3 id="download-template-script" tabindex="-1">Download Template Script <a class="header-anchor" href="#download-template-script" aria-label="Permalink to &quot;Download Template Script&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/oneclickvirt/pve/main/scripts/buildvm_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildvm_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildvm_macos.sh</span></span></code></pre></div><h3 id="parameter-meanings" tabindex="-1">Parameter Meanings <a class="header-anchor" href="#parameter-meanings" aria-label="Permalink to &quot;Parameter Meanings&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;"># ./buildvm_macos.sh VMID CPU_cores Memory Disk SSH_port VNC_port System Storage_disk Independent_IPV6(default_N_if_empty)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The disk size here is only the size of the virtual machine&#39;s disk. During the actual setup process, the program will also mount the boot disk and system image, so the actual disk requirement for setting up a virtual machine is virtual machine disk size + image size + boot disk size (500MB). Always be aware of whether your disk space is sufficient for setting up virtual machines.</p></div><h3 id="example-command" tabindex="-1">Example Command <a class="header-anchor" href="#example-command" aria-label="Permalink to &quot;Example Command&quot;">​</a></h3><p>Using the oldest version (high-sierra) as an example, the supported configuration is as follows (very laggy)</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./buildvm_macos.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">100</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">4096</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">45</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">44022</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">45901</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">high-sierra</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">local</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">N</span></span></code></pre></div><p>After the template is set up, you can run <code>cat vm100</code> to view information, or check the NOTES in the corresponding VM in the WEB interface.</p><p>Here is the information for the example VM:</p><table><thead><tr><th>Property</th><th>Value</th></tr></thead><tbody><tr><td>VMID</td><td>100</td></tr><tr><td>CPU cores</td><td>2</td></tr><tr><td>Memory size</td><td>4096MB</td></tr><tr><td>Disk size</td><td>45G</td></tr><tr><td>SSH port</td><td>44022</td></tr><tr><td>VNC port</td><td>45901</td></tr><tr><td>System</td><td>high-sierra</td></tr><tr><td>Host storage disk</td><td>local</td></tr><tr><td>Independent IPV6</td><td>N</td></tr></tbody></table><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note that VMID can only use numbers from 100 to 256, other numbers are not available</p></div><h2 id="macos-system-boot-and-installation" tabindex="-1">MACOS System Boot and Installation <a class="header-anchor" href="#macos-system-boot-and-installation" aria-label="Permalink to &quot;MACOS System Boot and Installation&quot;">​</a></h2><p>After completing the previous steps, you can see a gray virtual machine waiting to be started in the panel.</p><p><img src="`+n+'" alt="mac0"></p><p>After clicking start, enter the VNC panel. The selection box on the left has a full-screen button. It is recommended to operate in full screen to avoid resolution issues.</p><p><img src="'+i+'" alt="mac00"></p><p>After about 3 minutes of boot disk loading, a startup disk will be displayed on the left center of the screen. Click directly or press Enter.</p><p>After another 3-5 minutes of startup disk loading, four selection boxes will appear. Select <code>Disk Utility</code> and click to enter.</p><p><img src="'+l+'" alt="mac1"></p><p>After entering, you can see three disks and one image. Find the disk larger than 40G named <code>QEMU HARDDISK Media</code>, and click <code>Erase</code>.</p><p><img src="'+c+'" alt="mac2"></p><p>A pop-up window will appear, requiring you to rename the <code>name</code> to <code>macos</code> for easy identification and use later, then click <code>Erase</code> to continue initialization.</p><p><img src="'+r+'" alt="mac3"></p><p>After initialization is complete, click <code>Done</code>.</p><p><img src="'+p+'" alt="mac4"></p><p>Now you need to exit the <code>Disk Utility</code> interface. Click <code>Disk Utility</code> in the upper right corner and select <code>Quit Disk Utility</code> to exit the current selection box.</p><p><img src="'+d+'" alt="mac5"></p><p>Then you return to the previous four selection boxes. Select <code>Install macOS XXXX</code> (since I am using Big Sur as an example, XXXX is Big Sur), and click <code>continue</code>.</p><p><img src="'+m+'" alt="mac6"></p><p>In the following steps, continue clicking <code>continue</code>, then click <code>Agree</code>, and then <code>Agree</code> again.</p><p><img src="'+h+'" alt="mac7"></p><p><img src="'+u+'" alt="mac8"></p><p><img src="'+y+'" alt="mac9"></p><p>Until those three disks appear again, but here you can see the disk larger than 40G named <code>macos</code>. Select it and click <code>continue</code>.</p><p><img src="'+g+'" alt="mac10"></p><p>After a period of file copying and disk loading (about 12 minutes), you will formally enter the system installation phase. Choose your region based on where the host machine is located.</p><p><img src="'+C+'" alt="mac11"></p><p>After selecting the region, continue clicking <code>continue</code>.</p><p><img src="'+f+'" alt="mac12"></p><p><img src="'+b+'" alt="mac13"></p><p>Until the <code>Migration Assistant</code> data migration option appears, select <code>Not Now</code> in the lower left corner to not import user data.</p><p><img src="'+A+'" alt="mac14"></p><p>Then you will be prompted to create a user. Fill in the username, account name, and login password. After setting up, click <code>continue</code>.</p><p><img src="'+k+'" alt="mac15"></p><p>After that, you will continue clicking <code>continue</code> until the system installation is complete.</p><h2 id="network-configuration" tabindex="-1">Network Configuration <a class="header-anchor" href="#network-configuration" aria-label="Permalink to &quot;Network Configuration&quot;">​</a></h2><p>Since the system installation was performed in an offline environment, you need to manually configure a static network connection to the host&#39;s bridge.</p><p>Click the WIFI button in the upper right corner, turn off WIFI, and then click <code>Network Preferences ...</code></p><p><img src="'+D+'" alt="mac16"></p><p>After entering the settings interface, click the <code>Advanced</code> button to enter the advanced settings interface.</p><p><img src="'+w+'" alt="mac17"></p><p>Fill in the static network configuration in the <code>TCP/IP</code> tab.</p><p>Configure IPV4: <code>Manually</code></p><p>IPV4 Address: <code>172.16.1.xxx</code> (replace xxx with the IP you want to bind, my vmid is 100, so I wrote 100 for convenience)</p><p>Subnet Mask: <code>255.255.255.0</code></p><p>Router: <code>172.16.1.1</code></p><p>If you need to configure an IPV6 network, similar to the IPV4 settings above, you will need to fill in the public IPV6 address bound to the virtual machine (written in the Note box in the PVE panel), subnet mask 128, and the default gateway obtained by executing <code>cat /usr/local/bin/pve_check_ipv6</code> on the host.</p><p><img src="'+v+'" alt="mac18"></p><p>Fill in the static network DNS configuration in the <code>DNS</code> tab.</p><p>Generally, adding <code>8.8.8.8</code> and <code>1.1.1.1</code> is sufficient. For use in mainland China, use <code>114.114.114.114</code>.</p><p><img src="'+_+'" alt="mac19"></p><p>After filling in and applying, the top left of the settings will show that the network is connected.</p><p><img src="'+S+'" alt="mac20"></p><p>Now, opening the default browser and visiting any website will allow you to access public network resources, proving that the network has worked.</p><h2 id="remove-iso" tabindex="-1">Remove ISO <a class="header-anchor" href="#remove-iso" aria-label="Permalink to &quot;Remove ISO&quot;">​</a></h2><p>Manually click on the corresponding <code>CD</code> in the <code>Hardware</code> on the web side of ProxmoxVE and select <code>Remove</code>, then restart the VM and you can use it directly.</p><p><img src="'+o+'" alt="wk"></p><p>Macos system is to uninstall <code>opencore.iso</code> and <code>xxxx (the system image used for installation).iso</code>, similar to the Windows system uninstallation of win image and virtio image in the example picture above.</p>',90),M=[F];function P(I,B,q,E,z,V){return a(),s("div",null,M)}const G=e(x,[["render",P]]);export{N as __pageData,G as default};
