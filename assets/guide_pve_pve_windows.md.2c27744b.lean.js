import{_ as o,v as c,b as d,R as s}from"./chunks/framework.70afa331.js";const t="/assets/kvm.d81063e5.png",a="/assets/432192899-d9453c3b-46cd-4bc1-8c61-4f987b84dbdb.a2c0c1ef.png",i="/assets/432192951-c1dd421b-f516-47eb-a415-f54d56b34945.4fa2fea0.png",p="/assets/432193100-8ceb8253-1652-4194-bf7d-b64232612eaf.ea03923c.png",r="/assets/432193274-3704426d-d665-4672-b9f8-50504191eff0.b2be1a5c.png",n="/assets/432193298-0badebcb-5755-4ced-86cc-01368748f761.8e69987e.png",l="/assets/432193391-68f0eeeb-fc9f-4568-8ddf-777caf901345.8065a143.png",m="/assets/432193462-03a2728f-fa88-4884-a0f9-43f8e92f054b.4618bc7b.png",g="/assets/432193493-d549cae1-7cf1-40f5-9767-a628878520dc.c4992870.png",_="/assets/432193525-695a77d0-cadb-4eab-9c0c-d1cbea3f6d02.48037353.png",h="/assets/432193740-df901161-26b9-43d1-9106-baeb6485568c.0c3eac87.png",b="/assets/432193821-7c660689-c6bf-47fd-adef-e7bc3b139873.3aebbfd4.png",f="/assets/432193878-c7283ee4-d5cd-4091-a57f-e9e476468871.42bfd260.png",w="/assets/432193920-58698c75-97f4-4091-bbaa-a2a435468c28.ff78c941.png",v="/assets/432193959-c886b28e-8107-469c-9042-8479c46cabaa.4a04cf3d.png",k="/assets/432194105-63a1521a-b3fd-40ae-8992-b91046d0f346.e2343160.png",u="/assets/432194142-454b13e1-f948-4890-ab24-773afc0919e1.54522dff.png",x="/assets/432194244-228adbbf-4c00-48c0-bd58-94dc1f081369.97561122.png",C="/assets/432194273-9cb29c4c-78eb-49b2-9e1b-0e818bc9ca62.a8679083.png",q="/assets/432194639-ba4370df-ba6d-48fb-9255-e285f2d27377.fe7d0b3c.png",P="/assets/432194663-b4a7e456-878a-4829-bda1-05c8a9d6b6a7.4cdf4daa.png",I="/assets/net1.4f166207.png",S="/assets/net2.e2773ada.png",O="/assets/net3.40e8a226.png",V="/assets/net4.a81e777c.png",e="/assets/wk7.38e3cd7d.png",D="/assets/virtio.b42d8275.png",N="/assets/lower2.e782a20a.png",M="/assets/lower1.28498396.png",y="/assets/nodisk.5ec86f3b.png",U="/assets/nodisk1.671c1309.png",E="/assets/nodisk2.ff20bb76.png",B="/assets/nodisk3.71534a11.png",R="/assets/nodisk4.b08d75e3.png",G="/assets/wk4.004be17f.png",K="/assets/wk5.6cdba880.png",W="/assets/wk6.667c5c95.png",A="/assets/wk1.7d9f24d7.png",L="/assets/wk2.2e88d91a.png",T="/assets/wk3.975bc38e.png",oe=JSON.parse('{"title":"","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"guide/pve/pve_windows.md","filePath":"guide/pve/pve_windows.md","lastUpdated":1746072603000}'),H={name:"guide/pve/pve_windows.md"},$=s('<h2 id="开设时选择kvm虚拟化还是qemu的tcg仿真" tabindex="-1">开设时选择KVM虚拟化还是QEMU的TCG仿真 <a class="header-anchor" href="#开设时选择kvm虚拟化还是qemu的tcg仿真" aria-label="Permalink to &quot;开设时选择KVM虚拟化还是QEMU的TCG仿真&quot;">​</a></h2><p>宿主机本身如果支持嵌套虚拟化，那么就可用<code>host</code>或<code>kvm64</code>或<code>qemu64</code>类型的CPU</p><p>从性能上来说，<code>host</code> &gt; <code>kvm64</code> &gt; <code>qemu64</code></p><p><code>qemu</code>类型虚拟化性能损耗很多</p><p>如果本身不支持嵌套虚拟化，那么只能用<code>qemu64</code>类型的CPU，且需要在启动虚拟机前修改<code>Options[选项]</code>中的<code>KVM hardware virtualization[KVM硬件虚拟化]</code></p><p>设置为<code>no</code>取消<code>Enabled[启用]</code>的勾选</p><p><img src="'+t+'" alt="kvm"></p><p>如果你实在不清楚本机是否支持嵌套虚拟化，那么</p><p>借鉴</p><p><a href="https://cdn.spiritlhl.net/https://raw.githubusercontent.com/oneclickvirt/pve/main/scripts/check_kernal.sh" target="_blank" rel="noreferrer">https://cdn.spiritlhl.net/https://raw.githubusercontent.com/oneclickvirt/pve/main/scripts/check_kernal.sh</a></p><p>这块的逻辑，主要检测</p><p><code>egrep -c &#39;(vmx|svm)&#39; /proc/cpuinfo</code> 检测是否为1</p><p><code>cat /sys/module/kvm_intel/parameters/nested</code>是否存在且为1</p><p><code>lsmod | grep -q kvm</code>检测是否已加载</p><p>这些都支持的时候，才可选<code>host</code>类型</p><h2 id="使用带virtio的iso镜像文件开设" tabindex="-1">使用带virtio的iso镜像文件开设 <a class="header-anchor" href="#使用带virtio的iso镜像文件开设" aria-label="Permalink to &quot;使用带virtio的iso镜像文件开设&quot;">​</a></h2><h3 id="_1-下载镜像" tabindex="-1">1.下载镜像 <a class="header-anchor" href="#_1-下载镜像" aria-label="Permalink to &quot;1.下载镜像&quot;">​</a></h3><p>安装需要提前下载镜像文件<code>local(pve) --&gt; ISO images --&gt; Download from URL</code></p><p>下载链接<code>URL:</code>可使用</p><p><a href="https://github.com/ILLKX/Windows-VirtIO" target="_blank" rel="noreferrer">https://github.com/ILLKX/Windows-VirtIO</a></p><p>中的文件链接，文件名字<code>File Name:</code>填<code>win.iso</code></p><p><img src="'+a+'" alt="download"></p><p>点击下载<code>Download</code>，下载完成后当前的页面可见<code>win.iso</code>的文件大小，可见格式为iso。</p><p><img src="'+i+'" alt="downloaded"></p><h3 id="_2-设置模板" tabindex="-1">2.设置模板 <a class="header-anchor" href="#_2-设置模板" aria-label="Permalink to &quot;2.设置模板&quot;">​</a></h3><p>页面顶部右上角点击<code>Create VM</code></p><p><code>General</code>窗口中，<code>Resource Pool:</code>勾选<code>mypool</code>，<code>Name</code>填写<code>win</code>，然后点击<code>Next</code>。</p><p><img src="'+p+'" alt="general"></p><p><code>OS</code>窗口中，<code>ISO image</code>勾选<code>win.iso</code>，<code>Guest OS</code>勾选<code>Type</code>为<code>Microsoft Windows</code>类型，<code>Version</code>选择当前<code>ISO</code>的<code>win的版本</code>，示例下载是<code>2022</code>，就选<code>11/2022</code>类型，然后点击<code>Next</code>。</p><p><img src="'+r+'" alt="OS"></p><p><code>System</code>窗口中，<code>Graphic card</code>勾选<code>VirtIO-GPU</code>类型，<code>Machine</code>勾选<code>q35</code>类型，<code>SCSI Controller</code>勾选<code>VirtIO SCSI</code>类型，<code>BIOS</code>勾选<code>Default (SeaBIOS)</code>类型，然后点击<code>Next</code>。</p><p><img src="'+n+'" alt="system"></p><p><code>Disk</code>窗口中，<code>Cache</code>勾选<code>Write Back</code>类型，<code>Disk size (GiB)</code>填写你要分配的硬盘大小，一般不小于<code>20</code>，<code>Storage</code>选择存储在哪个盘，示例只有系统盘<code>local</code>所以就选<code>loacl</code>，然后点击<code>Next</code>。</p><p><img src="'+l+'" alt="disk"></p><p><code>CPU</code>窗口中，<code>Cores</code>填写所需核数，CPU类型按照前面描述的方法选择，然后点击<code>Next</code>。</p><p><img src="'+m+'" alt="cpu"></p><p><code>Memory</code>窗口中，<code>Memory (MiB)</code>填写所需内存大小，然后点击<code>Next</code>。</p><p><img src="'+g+'" alt="memory"></p><p><code>Network</code>窗口中，<code>Bridge</code>勾选<code>vmbr1</code>类型，<code>Model</code>勾选<code>VirtIO (paravirtualized)</code>类型，<code>Firewall</code>取消勾选，然后点击<code>Next</code>。</p><p><img src="'+_+'" alt="Network"></p><p><code>Confirm</code>窗口中，点击<code>Finish</code>。</p><p><img src="'+h+'" alt="finish"></p><h3 id="_3-图形化配置安装" tabindex="-1">3.图形化配置安装 <a class="header-anchor" href="#_3-图形化配置安装" aria-label="Permalink to &quot;3.图形化配置安装&quot;">​</a></h3><p>左侧点击设置好的模板，右上角点击<code>Start</code>启动虚拟机，然后点击<code>Console</code>进入<code>VNC</code>界面，等待操作系统启动。</p><p><img src="'+b+'" alt="console"></p><p>然后在VNC中点击<code>下一页</code>，然后点击<code>现在安装</code>，然后点击<code>我没有产品密钥</code>，然后勾选<code>接受许可</code>，点击<code>下一页</code>，然后勾选<code>自定义安装</code>。</p><p><img src="'+f+'" alt="win0"></p><p><img src="'+w+'" alt="win1"></p><p><img src="'+v+'" alt="win2"></p><p><img src="'+k+'" alt="win3"></p><p><img src="'+u+'" alt="win4"></p><p>然后如果镜像本身带virtio，那么应该可见可选系统存储的硬盘及其大小，选中后点击<code>下一页</code>。</p><p><img src="'+x+'" alt="win5"></p><p><img src="'+C+'" alt="win6"></p><p>然后等待系统安装，应该会自动重启几次，大概耗时10分钟以上。</p><p><img src="'+q+'" alt="win7"></p><p>安装完成后首次登录会要求设置密码，正常设置即可</p><p><img src="'+P+'" alt="win8"></p><p>设置完成后，NOVNC页面左侧有一个弹出框，点击第一个按钮，然后根据登录提示，点击<code>Ctrl</code>+<code>Alt</code>+最后一个按钮，进入登录页面。</p><h3 id="_4-初始化网络" tabindex="-1">4.初始化网络 <a class="header-anchor" href="#_4-初始化网络" aria-label="Permalink to &quot;4.初始化网络&quot;">​</a></h3><p>由于通过本项目设置的PVE是静态网络，所以登陆后需要手动修改绑定的IP地址，不通过DHCP</p><p>在桌面右下角右击点出<code>打开 网络和Internet设置</code>，点击后，在弹出的设置页面中点击<code>更改适配器设置</code></p><p><img src="'+I+'" alt="win9"></p><p>然后在<code>网络链接</code>中勾选<code>以太网</code>，点击<code>更改此连接的设置</code></p><p><img src="'+S+'" alt="win10"></p><p>在弹出框中点击<code>Internet协议版本4(TCP/IPV4)</code>选中后点击<code>属性</code></p><p><img src="'+O+`" alt="win11"></p><p>在新弹出的弹出框中，选择并点击<code>使用下面的IP地址(s)</code>，然后分别填入</p><p>IP地址(I)：<code>172.16.1.xxx</code>(xxx换成你想绑定的ip，我的vmid是100，为了方便写了100)</p><p>子网掩码(U)：<code>255.255.255.0</code></p><p>默认网关(D)：<code>172.16.1.1</code></p><p>然后选择点击<code>使用下面的DNS服务器地址(E)</code>，分别填入</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">8.8.8.8</span></span>
<span class="line"><span style="color:#A6ACCD;">144.144.144.144</span></span></code></pre></div><p>然后右下角点击确定，注意<code>不要</code>勾选<code>退出时验证</code></p><p><img src="`+V+'" alt="win12"></p><p>然后其他弹出框都选<code>确定</code>和<code>是</code>就行了，然后本虚拟机就有网络了。</p><h3 id="_5-取消cd盘挂载" tabindex="-1">5.取消CD盘挂载 <a class="header-anchor" href="#_5-取消cd盘挂载" aria-label="Permalink to &quot;5.取消CD盘挂载&quot;">​</a></h3><p>在ProxmoxVE的web端手动在<code>Hardware[硬件]</code>中点击对应的<code>CD</code>选择<code>Remove[删除]</code>然后再重启虚拟机，这样就能直接使用了</p><p><img src="'+e+'" alt="wk"></p><h2 id="使用不带virtio的iso镜像开设" tabindex="-1">使用不带virtio的iso镜像开设 <a class="header-anchor" href="#使用不带virtio的iso镜像开设" aria-label="Permalink to &quot;使用不带virtio的iso镜像开设&quot;">​</a></h2><h3 id="_1-下载镜像-1" tabindex="-1">1.下载镜像 <a class="header-anchor" href="#_1-下载镜像-1" aria-label="Permalink to &quot;1.下载镜像&quot;">​</a></h3><p>无virtio的win镜像下载可使用</p><p><a href="https://down.idc.wiki/ISOS/Windows/" target="_blank" rel="noreferrer">https://down.idc.wiki/ISOS/Windows/</a></p><p>这块的镜像</p><p>virtio的iso镜像可使用</p><p><a href="https://down.idc.wiki/ISOS/Toolkit/" target="_blank" rel="noreferrer">https://down.idc.wiki/ISOS/Toolkit/</a></p><p>或者</p><p><a href="https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/" target="_blank" rel="noreferrer">https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/</a></p><p>下载</p><p>virtio也可以只下载msi包，本地用软件打包成iso压缩格式再本地上传到ProxmoxVE中也可以</p><p>这样的话包小一些，前者官方的是包含所有WIN镜像支持的包总计500MB左右，后者自己打包5MB左右</p><h3 id="_2-virtio导入" tabindex="-1">2.virtio导入 <a class="header-anchor" href="#_2-virtio导入" aria-label="Permalink to &quot;2.virtio导入&quot;">​</a></h3><p>注意这里的导入在ProxmoxVE的8.x及之后的版本中，OS这一栏默认可选择virtio启动加载，如图所示</p><p><img src="'+D+'" alt="virtio"></p><p>而在更低版本的ProxmoxVE中，比如7.x和6.x的版本，OS这一栏默认无法选择virtio启动加载</p><p><img src="'+N+'" alt="lower"></p><p>需要手动在<code>Hardware[硬件]</code>中点击<code>Add[添加]</code>添加<code>CD/DVD Drive</code>选择下载好的<code>virtio</code>的<code>ISO</code>文件</p><p><img src="'+M+'" alt="lower"></p><p>然后其他的一切照常，直到</p><p><img src="'+y+'" alt="nodisk"></p><p>这块找不到硬盘，需要选择<code>加载驱动程序</code></p><p><img src="'+U+'" alt="nodisk"></p><p>然后选择<code>驱动盘</code>是<code>virtio</code>的，点击打开，从<code>amd64</code>那导入对应系统名字的驱动</p><p><img src="'+E+'" alt="nodisk"></p><p>我的是<code>windows server 2019</code>的镜像所以导入的是<code>2k19</code>的驱动，导入完毕后选择导入的驱动，点击<code>下一页</code></p><p><img src="'+B+'" alt="nodisk"></p><p><img src="'+R+'" alt="nodisk"></p><p>这样就能看得到硬盘了，选中后继续后续的安装步骤，选中后继续后续的安装步骤如同前面的教程，直到系统安装完毕，进入桌面。</p><h3 id="_3-通过virtio-win-guest-tools安装驱动" tabindex="-1">3.通过virtio-win-guest-tools安装驱动 <a class="header-anchor" href="#_3-通过virtio-win-guest-tools安装驱动" aria-label="Permalink to &quot;3.通过virtio-win-guest-tools安装驱动&quot;">​</a></h3><p>此时安装成功，出现桌面后，还需要手动安装驱动</p><p>打开<code>VirtIO</code>驱动所在的<code>CD</code>光驱目录，最下面有一个<code>virtio-win-guest-tools</code>程序，会安装用到的virtio驱动，这个驱动也会包含virtio的网卡驱动</p><p><img src="'+G+'" alt="wk"></p><p><img src="'+K+'" alt="wk"></p><p><img src="'+W+'" alt="wk"></p><p>点击安装完毕后就安装上网卡驱动了，后续网络设置参考前面的初始化网络的教程</p><h3 id="_4-安装网卡驱动-备选" tabindex="-1">4.安装网卡驱动(备选) <a class="header-anchor" href="#_4-安装网卡驱动-备选" aria-label="Permalink to &quot;4.安装网卡驱动(备选)&quot;">​</a></h3><p>此时安装成功，出现桌面后，还需要手动安装网卡驱动才能连通网络：</p><ol><li>打开 <strong>控制面板</strong> → <strong>设备管理器</strong></li><li>找到 <strong>以太网控制器</strong>，右键选择 <strong>更新驱动程序</strong></li><li>选择 <strong>浏览我的计算机以查找驱动程序软件 (R)</strong></li><li>浏览到<code>VirtIO</code>驱动所在的<code>CD</code>光驱目录</li><li>打开其中的 <strong>NetKVM</strong> 文件夹</li><li>根据当前系统版本选择对应的驱动文件夹(和上面相同的操作，我会选择2k19文件夹，里面的amd64驱动)</li><li>确认安装，完成后即可成功加载<code>VirtIO</code>的网卡驱动</li></ol><p><img src="'+A+'" alt="wk"></p><p><img src="'+L+'" alt="wk"></p><p><img src="'+T+'" alt="wk"></p><p>后续网络设置参考前面的初始化网络的教程</p><h3 id="_5-取消cd盘挂载-1" tabindex="-1">5.取消CD盘挂载 <a class="header-anchor" href="#_5-取消cd盘挂载-1" aria-label="Permalink to &quot;5.取消CD盘挂载&quot;">​</a></h3><p>在ProxmoxVE的web端手动在<code>Hardware[硬件]</code>中点击对应的<code>CD</code>选择<code>Remove[删除]</code>然后再重启虚拟机，这样就能直接使用了</p><p><img src="'+e+'" alt="wk"></p>',125),z=[$];function F(Q,X,J,j,Y,Z){return c(),d("div",null,z)}const ce=o(H,[["render",F]]);export{oe as __pageData,ce as default};
