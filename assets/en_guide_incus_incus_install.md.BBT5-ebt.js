import{_ as a,c as e,o as i,ag as t}from"./chunks/framework.CSeR4K32.js";const u=JSON.parse('{"title":"Incus","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"en/guide/incus/incus_install.md","filePath":"en/guide/incus/incus_install.md","lastUpdated":1761617633000}'),n={name:"en/guide/incus/incus_install.md"};function l(o,s,p,h,r,c){return i(),e("div",null,s[0]||(s[0]=[t(`<h1 id="incus" tabindex="-1">Incus <a class="header-anchor" href="#incus" aria-label="Permalink to &quot;Incus&quot;">​</a></h1><p>If your host does not have an IPV6 subnet and you want to assign IPV6 addresses to containers, then please check the <code>Customize</code> partition in the <code>incus</code> module for the <code>Attach a free IPV6 address segment</code> to the host, and attach an IPV6 subnet to the host before installing the environment.</p><h2 id="setting-up-virtual-memory-swap-optional-not-required" tabindex="-1">Setting up virtual memory (SWAP) (optional, not required) <a class="header-anchor" href="#setting-up-virtual-memory-swap-optional-not-required" aria-label="Permalink to &quot;Setting up virtual memory (SWAP) (optional, not required)&quot;">​</a></h2><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Memory to open some swap lest the machine blow up, if your host computer does not have enough memory and a lot of free hard disk.</p></div><p>Unit conversion: Enter 1024 to generate 1G SWAP-virtual memory, virtual memory occupies hard disk space.</p><p>When the actual memory is not enough, the virtual memory will be automatically used for memory usage, but it will bring high IO usage and CPU performance.</p><p>Refer to the description of the organization&#39;s related project <a href="https://github.com/oneclickvirt/ecs/blob/master/README_NEW_USER.md" target="_blank" rel="noreferrer">Jump</a> This opens the size of virtual memory</p><table tabindex="0"><thead><tr><th>Physical Memory Size</th><th>Recommended SWAP Size</th></tr></thead><tbody><tr><td>≤ 2G</td><td>2x memory size</td></tr><tr><td>2G &lt; memory ≤ 8G</td><td>Equal to physical memory</td></tr><tr><td>≥ 8G</td><td>About 8G is sufficient</td></tr><tr><td>Hibernation needed</td><td>At least equal to physical memory</td></tr></tbody></table><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/spiritLHLS/addswap/main/addswap.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addswap.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addswap.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> addswap.sh</span></span></code></pre></div><h2 id="incus-one-click-installation-guide" tabindex="-1">Incus One-Click Installation Guide <a class="header-anchor" href="#incus-one-click-installation-guide" aria-label="Permalink to &quot;Incus One-Click Installation Guide&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>If this is a new server, make sure that both <code>update</code> and <code>curl</code> are working properly before executing this script.</p></div><ul><li>Prerequisites: Ubuntu 20+(Not recommended to use Incus, please use LXD), Debian 11+(Recommended), RockyLinux 9+, AlmaLinux 9+, Centos 9+</li><li>During installation, you will be prompted to enter the storage pool creation path as well as the size, and all the VMs or containers you want to open end up taking up space in the storage pool</li><li>The server needs to be restarted after the environment installation process to load some default configurations</li><li>By default, lxd&#39;s lxcfs-related configuration is enabled, so that in-container querying of container information changes to information about the container itself rather than the host</li><li>This installer has been tested to work on either physical or non-physical machines</li></ul><p>Command:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/oneclickvirt/incus/main/scripts/incus_install.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> incus_install.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> incus_install.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> incus_install.sh</span></span></code></pre></div><p>OR</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> incus_install.sh</span></span></code></pre></div><p>Example of initialization configuration:</p><p>If you don&#39;t need to specify the path of a non-system disk as the default storage pool, then you can directly enter or type <code>n</code> when choosing whether to customize the storage pool path, and you don&#39;t need to specify the path.</p><p>If you need to specify the path of a non-system disk as the default pool, then you need to select <code>y</code> and enter the corresponding path (the actual absolute path of the disk you mounted).</p><p>If the corresponding disk has 18 Gigabytes of free hard disk space in addition to the occupied space and you want to open a 15 Gigabyte storage pool, follow the command line prompts to enter <code>15</code>.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>The execution process <strong>may</strong> require a <strong>manual reboot</strong> to load the storage type into the kernel, the installation is completed at the end of the execution will <strong>automatically reboot</strong> the server, the first time after the complete installation of the reboot will take about 400 ~ 500 seconds, please be patient</p></div><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>If you need to open more than 200 Incus containers on a single server, then it is not recommended to use this project, there may be problems with lxcfs access drift, which generates IO occupancy that cannot be released. (This is a native LXC problem that can&#39;t be fixed.)</p></div><h2 id="manual-installation-optional" tabindex="-1">Manual Installation (optional) <a class="header-anchor" href="#manual-installation-optional" aria-label="Permalink to &quot;Manual Installation (optional)&quot;">​</a></h2><p>Not recommended, just to install for some oddball environments where one-click scripts won&#39;t run, or if you want to understand the most basic Incus installation process.</p><h3 id="disable-firewall" tabindex="-1">Disable Firewall <a class="header-anchor" href="#disable-firewall" aria-label="Permalink to &quot;Disable Firewall&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> update</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">apt</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> curl</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> wget</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> sudo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> dos2unix</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ufw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> jq</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">ufw</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> disable</span></span></code></pre></div><h3 id="enabling-virtual-memory-swap" tabindex="-1">Enabling Virtual Memory SWAP <a class="header-anchor" href="#enabling-virtual-memory-swap" aria-label="Permalink to &quot;Enabling Virtual Memory SWAP&quot;">​</a></h3><p>The amount of memory depends on how many instances you want to run. If you want to run 8 instances and calculate, you&#39;ll need 2GB of memory. If your actual physical memory is 512MB, you&#39;ll need an additional 1.5GB. To be cautious, allocate 2GB of virtual memory.</p><p>Execute the following commands: Enter &#39;1&#39;, then enter &#39;2048&#39;. This signifies allocating 2GB of virtual memory.</p><p>Command:</p><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">curl</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -L</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> https://raw.githubusercontent.com/oneclickvirt/incus/main/scripts/swap.sh</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -o</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swap.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">chmod</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> +x</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swap.sh</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> &amp;&amp; </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bash</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> swap.sh</span></span></code></pre></div><h3 id="installing-incus" tabindex="-1">Installing incus <a class="header-anchor" href="#installing-incus" aria-label="Permalink to &quot;Installing incus&quot;">​</a></h3><p>Actually, the virtual memory allocated for swap should be twice the size of the actual memory. So, it&#39;s reasonable to allocate 1GB if the actual memory is 500MB. The scenario I described above is an excessive allocation.</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>sudo -i</span></span>
<span class="line"><span>mkdir -p /etc/apt/keyrings/</span></span>
<span class="line"><span>curl -fsSL https://pkgs.zabbly.com/key.asc | gpg --dearmor -o /etc/apt/keyrings/zabbly.gpg</span></span>
<span class="line"><span>sh -c &#39;cat &lt;&lt;EOF &gt; /etc/apt/sources.list.d/zabbly-incus-stable.sources</span></span>
<span class="line"><span>Enabled: yes</span></span>
<span class="line"><span>Types: deb</span></span>
<span class="line"><span>URIs: https://pkgs.zabbly.com/incus/stable</span></span>
<span class="line"><span>Suites: $(. /etc/os-release &amp;&amp; echo \${VERSION_CODENAME})</span></span>
<span class="line"><span>Components: main</span></span>
<span class="line"><span>Architectures: $(dpkg --print-architecture)</span></span>
<span class="line"><span>Signed-By: /etc/apt/keyrings/zabbly.gpg</span></span>
<span class="line"><span>EOF&#39;</span></span>
<span class="line"><span>apt-get update</span></span>
<span class="line"><span>apt-get install incus -y</span></span>
<span class="line"><span>incus -h</span></span></code></pre></div><p>If there are no exceptions, continue execution</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>incus admin init</span></span></code></pre></div><p>Just enter the default for the normal options</p><p>Choose the size of the physical disk (hint: select the default option with a minimum of 1GB). Generally, I fill in the available disk space minus the memory size, then multiply by 0.95 and round down. Here, I entered 10GB.</p><p>Remember to select &#39;no&#39; for options containing &#39;auto&#39; when prompted to update the image, in order to avoid occupying the system.</p>`,39)]))}const k=a(n,[["render",l]]);export{u as __pageData,k as default};
