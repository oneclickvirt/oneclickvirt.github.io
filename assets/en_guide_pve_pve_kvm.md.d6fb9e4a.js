import{_ as s,v as a,b as e,R as t}from"./chunks/framework.70afa331.js";const y=JSON.parse('{"title":"KVM Virtualization","description":"","frontmatter":{"outline":"deep"},"headers":[],"relativePath":"en/guide/pve/pve_kvm.md","filePath":"en/guide/pve/pve_kvm.md","lastUpdated":1707490747000}'),n={name:"en/guide/pve/pve_kvm.md"},o=t(`<h1 id="kvm-virtualization" tabindex="-1">KVM Virtualization <a class="header-anchor" href="#kvm-virtualization" aria-label="Permalink to &quot;KVM Virtualization&quot;">​</a></h1><h2 id="ssh-login-instructions" tabindex="-1">SSH Login Instructions <a class="header-anchor" href="#ssh-login-instructions" aria-label="Permalink to &quot;SSH Login Instructions&quot;">​</a></h2><p>The virtual machines created through KVM virtualization do not have the username <code>root</code> by default. To switch to the root user, you need to execute <code>sudo -i</code> .</p><p><strong>Default allow logging in with the username <code>root</code>, and the default root password is <code>password</code> or <code>oneclickvirt</code>. You can give it a try.</strong></p><p>Once you&#39;ve logged in via SSH and switched to root privileges, it&#39;s crucial to change the root password. You can use the following command to do so.</p><p>Command:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&lt;(</span><span style="color:#FFCB6B;">curl</span><span style="color:#C3E88D;"> -sSL https://raw.githubusercontent.com/fscarmen/tools/main/root.sh</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> [PASSWORD]</span></span></code></pre></div><h2 id="partial-notes" tabindex="-1">Partial Notes <a class="header-anchor" href="#partial-notes" aria-label="Permalink to &quot;Partial Notes&quot;">​</a></h2><p><strong>Commands to set up the testing environment for executing this project are as follows:</strong></p><p><img src="https://github.com/spiritLHLS/pages/blob/main/pve_kvm_1.png?raw=true" alt="图片"></p><p>To perform the above-mentioned query, you only need to use the one-click script below to automatically create a virtual machine. There is no need to manually modify settings on the web interface.</p><p><img src="https://github.com/spiritLHLS/pages/blob/main/pve_kvm_2.png?raw=true" alt="图片"></p><p>After creating the virtual machines using the subsequent script as mentioned above, it <strong>may</strong> be necessary to manually modify the settings on the web interface. You will need to disable hardware nested virtualization for each respective virtual machine, as shown in the following diagram.</p><p><img src="https://github.com/spiritLHLS/pages/blob/main/pve_kvm_3.png?raw=true" alt="图片"></p><p>Stop the virtual machine before making modifications. After the modifications are done, you can start the machine to use NOVNC. Failure to close it <strong>may</strong> result in bugs that render this virtual machine unusable.</p><p>If you forcibly install PVE to enable KVM, even if the startup fails, you can also disable this option and try to start the virtual machine to see if it works.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Please use the &quot;screen&quot; command to suspend execution before launching the virtual machine, in order to avoid prolonged startup times. Unstable SSH connections could lead to interruptions during the intermediate execution.</p></div><h2 id="considerations-for-opening-a-kvm-virtual-machine-with-an-ipv6-address" tabindex="-1">Considerations for opening a KVM virtual machine with an IPV6 address <a class="header-anchor" href="#considerations-for-opening-a-kvm-virtual-machine-with-an-ipv6-address" aria-label="Permalink to &quot;Considerations for opening a KVM virtual machine with an IPV6 address&quot;">​</a></h2><p>Due to long-term inactivity IPV6 does not use may lead to NDP broadcast cache invalidation reset, generally idle for about 50 minutes will appear IPV6 unavailable, commonly known as &quot;IPV6 cutoff&quot;, at this time it is necessary to set up a timer task.</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">echo</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">*/1 * * * * curl -m 6 -s ipv6.ip.sb || curl -m 6 -s ipv6.ip.sb</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">crontab</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-</span></span></code></pre></div><p>Executing the above commands in the opened virtual machine ensures that the IPV6 network is always used and does not fail over.</p><h2 id="images-available-for-creating-kvm-virtual-machines" tabindex="-1">Images available for creating KVM virtual machines <a class="header-anchor" href="#images-available-for-creating-kvm-virtual-machines" aria-label="Permalink to &quot;Images available for creating KVM virtual machines&quot;">​</a></h2><ul><li>Pre-installed with cloud-init enabled.</li><li>Enabled SSH login.</li><li>Pre-configured SSH to listen on ports 22 for both IPv4 and IPv6.</li><li>Enabled password authentication for login.</li><li>Enabled root login.</li><li>Partially pre-installed QEMU guest agent.</li></ul><p>The list of currently available image names is as follows:</p><p><a href="https://github.com/oneclickvirt/kvm_images/blob/main/list.text" target="_blank" rel="noreferrer">https://github.com/oneclickvirt/kvm_images/blob/main/list.text</a></p><p>and</p><p><a href="https://github.com/oneclickvirt/pve_kvm_images" target="_blank" rel="noreferrer">https://github.com/oneclickvirt/pve_kvm_images</a></p><p>Daily patch images stored in the Release of this repository.</p><h2 id="virtual-machines-with-standalone-nat-configuration-in-kvm-virtualization" tabindex="-1">Virtual machines with standalone NAT configuration in KVM virtualization. <a class="header-anchor" href="#virtual-machines-with-standalone-nat-configuration-in-kvm-virtualization" aria-label="Permalink to &quot;Virtual machines with standalone NAT configuration in KVM virtualization.&quot;">​</a></h2><ul><li>Automatically deploy NAT servers with the default Debian 10 image, chosen for its minimal footprint.</li><li>It&#39;s possible to customize the image used through the command, and pre-configured images are available. These images come with storage settings ranging from 2 to 10 GB of disk space. For regular use, <strong>at least 10 GB</strong> of disk space is recommended. You can increase the disk size if certain images fail to start.</li><li>The command allows for specifying the storage disk location. When not specified, it defaults to the local disk, which is the system disk. It can also be set to a mount disk as displayed in PVE.</li><li>Recommended custom memory size is 512 MB.</li><li>Automatic internal and external port mapping, including ports 22, 80, 443, and 25 other port numbers shared between internal and external networks.</li><li>After generation, there&#39;s a wait time for the virtual machine&#39;s internal cloud-init configuration to establish network and login information. This process takes approximately 5 minutes.</li><li>Pertinent virtual machine information will be stored in the NOTES section of the corresponding VM on the web interface, accessible for viewing through the web portal.</li><li>If the host machine has an IPV6 subnet, IPV6 networking will be automatically added. However, there won&#39;t be any public IPV6 addresses.</li><li>Optionally enable or disable standalone IPV6, requires the host to have at least one /64 subnet</li></ul><h3 id="usage-instructions" tabindex="-1">Usage Instructions <a class="header-anchor" href="#usage-instructions" aria-label="Permalink to &quot;Usage Instructions&quot;">​</a></h3><p>System Support:</p><ul><li>For x86_64 architecture systems listed in <a href="https://github.com/oneclickvirt/kvm_images/releases/tag/v1.0" target="_blank" rel="noreferrer">this link</a>, simply use the filename without the .qcow2 extension when using.</li><li>For arm architecture systems listed at <a href="http://cloud-images.ubuntu.com/" target="_blank" rel="noreferrer">this link</a>, use the system name and version number, such as ubuntu20 or ubuntu22.</li></ul><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note that usernames consisting of only numbers may cause issues with cloud-init. It&#39;s preferable to use usernames that are entirely in English or start with an English character.</p></div><p><strong>Download Script</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/spiritLHLS/pve/main/scripts/buildvm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildvm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildvm.sh</span></span></code></pre></div><p><strong>Meaning of each parameter</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./buildvm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">VMID</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Username</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Password</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Number_of_CPU_Cores</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Memory</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Disk</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">SSH_Port</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Port_80</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Port_443</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Public_Port_Start</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Public_Port_End</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">System</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Storage_Disk</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Independent_IPV6_address</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">leave</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">default</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">N</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">blank</span><span style="color:#89DDFF;">)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note that the Password here should be a mix of English and numbers only, and start with English, so as to avoid failing to set the Password due to special characters being escaped during the setup process.</p></div><h3 id="test-example" tabindex="-1">Test Example <a class="header-anchor" href="#test-example" aria-label="Permalink to &quot;Test Example&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./buildvm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">102</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">oneclick123</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">512</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">40001</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">40002</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">40003</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">50000</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">50025</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">debian11</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">local</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">N</span></span></code></pre></div><p>After setup is completed, you can execute <code>cat vm102</code> to view the information or check the NOTES section for the corresponding VM on the WEB interface.</p><p>Below is the information for the example VM that has been set up:</p><table><thead><tr><th>Attribute</th><th>Value</th></tr></thead><tbody><tr><td>VMID</td><td>102</td></tr><tr><td>SSH Username</td><td>test1</td></tr><tr><td>SSH Password</td><td>oneclick123</td></tr><tr><td>Number of CPU Cores</td><td>1</td></tr><tr><td>Memory Size</td><td>512MB</td></tr><tr><td>Disk Size</td><td>10G</td></tr><tr><td>SSH Port</td><td>40001</td></tr><tr><td>Port 80</td><td>40002</td></tr><tr><td>Port 443</td><td>40003</td></tr><tr><td>Port Range for NAT</td><td>50000 to 50025</td></tr><tr><td>Operating System</td><td>debian11</td></tr><tr><td>Host Storage Disk</td><td>local</td></tr><tr><td>IPV6 address</td><td>N</td></tr></tbody></table><h2 id="deletion-specific-vm" tabindex="-1">Deletion specific VM <a class="header-anchor" href="#deletion-specific-vm" aria-label="Permalink to &quot;Deletion specific VM&quot;">​</a></h2><ul><li>Stop VM</li><li>Delete VM</li><li>Delete port mapping</li><li>Restart network</li><li>Delete log files</li></ul><p><strong>Download Script</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/spiritLHLS/pve/main/scripts/pve_delete.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pve_delete.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">pve_delete.sh</span></span></code></pre></div><p><strong>Meaning of each parameter</strong></p><p>You can delete the VM with the corresponding VMID, as demonstrated here using the example 102 above</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./pve_delete.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">102</span></span></code></pre></div><p>The actual number of deletions is not fixed, a space separates each VMID, and more than one can be deleted at a time.</p><h2 id="batch-creation-of-virtual-machines-with-kvm-virtualization-and-nat" tabindex="-1">Batch Creation of Virtual Machines with KVM Virtualization and NAT <a class="header-anchor" href="#batch-creation-of-virtual-machines-with-kvm-virtualization-and-nat" aria-label="Permalink to &quot;Batch Creation of Virtual Machines with KVM Virtualization and NAT&quot;">​</a></h2><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Before initial use, ensure that the current Proxmox Virtual Environment (PVE) is clean and the host machine has not undergone any port forwarding, as conflicting settings may result in bugs.</p></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Before initiating the batch creation process, please use the &#39;screen&#39; command to execute it in the background. This will help avoid interruptions due to the instability of SSH caused by extended batch creation times.</p></div><ul><li>The batch creation process can be run multiple times to generate multiple virtual machines (VMs).</li><li>NAT servers are automatically created during the process. If left blank, the default Debian 11 image will be used. You can also customize the image name. Refer to the list of supported images in the previous section.</li><li>Automatic internal and external port mapping is performed, including ports 22, 80, 443, and other ports with identical internal and external numbers (25 ports in total).</li><li>After generation, a waiting period is required for the cloud-init configuration of the VM&#39;s network and login information to be set up. This process takes approximately 5 minutes. There is a 60-second interval between creating each VM to avoid potential performance issues.</li><li>The default network configuration for VMs created in batches includes port mappings for ports 22, 80, 443, and a range of 25 ports for internal and external communication.</li><li>You can customize the number of CPU cores, memory size, disk size, and which storage disk on the host machine to use for batch creation. Ensure you calculate available resources before proceeding.</li><li>Relevant information about the virtual machines will be stored in the &#39;NOTES&#39; section of the corresponding VM on the web interface, where you can view them.</li><li>If the host machine comes with an IPv6 subnet, an IPv6 network will be automatically attached, although there will be no public IPv6 addresses available.</li><li>Optionally enable or disable standalone IPV6, requires the host to have at least one /64 subnet.</li></ul><p>Command:</p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/spiritLHLS/pve/main/scripts/create_vm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create_vm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create_vm.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">bash</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">create_vm.sh</span></span></code></pre></div><p>After the setup is completed, you can execute <code>cat vmlog</code> to view the information, or check the NOTES in the corresponding VM on the web interface.</p><h2 id="delete-all-virtual-machines" tabindex="-1">Delete All Virtual Machines <a class="header-anchor" href="#delete-all-virtual-machines" aria-label="Permalink to &quot;Delete All Virtual Machines&quot;">​</a></h2><ul><li>Delete all VMs</li><li>Delete all NAT port mappings</li><li>Restart the network</li><li>Delete log files</li></ul><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;font-style:italic;">for</span><span style="color:#A6ACCD;"> vmid </span><span style="color:#89DDFF;font-style:italic;">in</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">$(</span><span style="color:#FFCB6B;">qm</span><span style="color:#C3E88D;"> list </span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;"> </span><span style="color:#FFCB6B;">awk</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{if(NR&gt;1) print $1}</span><span style="color:#89DDFF;">&#39;)</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">do</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">qm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> $vmid</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">qm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">destroy</span><span style="color:#A6ACCD;"> $vmid</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-rf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/var/lib/vz/images/</span><span style="color:#A6ACCD;">$vmid</span><span style="color:#A6ACCD;">*</span><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">done</span></span>
<span class="line"><span style="color:#FFCB6B;">iptables</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">nat</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-F</span></span>
<span class="line"><span style="color:#FFCB6B;">iptables</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-t</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">filter</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-F</span></span>
<span class="line"><span style="color:#FFCB6B;">service</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">networking</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">networking.service</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ndpresponder.service</span></span>
<span class="line"><span style="color:#FFCB6B;">iptables-save</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">awk</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">{if($1==&quot;COMMIT&quot;){delete x}}$1==&quot;-A&quot;?!x[$0]++:1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">iptables-restore</span></span>
<span class="line"><span style="color:#FFCB6B;">iptables-save</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">/etc/iptables/rules.v4</span></span>
<span class="line"><span style="color:#FFCB6B;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-rf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vmlog</span></span>
<span class="line"><span style="color:#FFCB6B;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-rf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vm</span><span style="color:#A6ACCD;">*</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Before modifying the VM configuration for PVE, you must shut it down first. After making the configuration changes, start it again to avoid configuration reload errors.</p></div><h2 id="setting-up-virtual-machines-with-dedicated-ipv4-addresses" tabindex="-1">Setting Up Virtual Machines with Dedicated IPv4 Addresses <a class="header-anchor" href="#setting-up-virtual-machines-with-dedicated-ipv4-addresses" aria-label="Permalink to &quot;Setting Up Virtual Machines with Dedicated IPv4 Addresses&quot;">​</a></h2><p>Two versions are available, choose as needed.</p><h3 id="version-with-automatic-selection-of-ipv4-address-no-manual-specification-required" tabindex="-1">Version with Automatic Selection of IPv4 Address (No Manual Specification Required) <a class="header-anchor" href="#version-with-automatic-selection-of-ipv4-address-no-manual-specification-required" aria-label="Permalink to &quot;Version with Automatic Selection of IPv4 Address (No Manual Specification Required)&quot;">​</a></h3><div class="warning custom-block"><p class="custom-block-title">WARNING</p><p>Before use, ensure that the current host machine has at least 2 available IP addresses within its IP range, and there are unallocated IP addresses. These unallocated IP addresses should not be bound to the host machine.</p></div><ul><li>Automatically detect available IP ranges. Use ping to identify unallocated IP addresses and select one to bind to the virtual machine.</li><li>If the host machine has an accompanying IPv6 subnet, there will be an option to attach an IPv6 address.</li><li>Relevant system information will be stored in the corresponding virtual machine&#39;s NOTE section, accessible for viewing on the web interface.</li><li>Optionally enable or disable standalone IPV6, requires the host to have at least one /64 subnet.</li></ul><h4 id="usage-instructions-1" tabindex="-1">Usage Instructions <a class="header-anchor" href="#usage-instructions-1" aria-label="Permalink to &quot;Usage Instructions&quot;">​</a></h4><p><strong>Download Script</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/spiritLHLS/pve/main/scripts/buildvm_extraip.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildvm_extraip.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildvm_extraip.sh</span></span></code></pre></div><p><strong>Meaning of each parameter</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./buildvm_extraip.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">VMID</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Username</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Password</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Number_of_CPU_Cores</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Memory_Size_in_MB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Disk_Size_in_GB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">OS</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Storage_Disk</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">Attach_IPV6</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">Default</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">is</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">N</span><span style="color:#89DDFF;">)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note that the Password here should be a mix of English and numbers only, and start with English, so as to avoid failing to set the Password due to special characters being escaped during the setup process.</p></div><h4 id="test-example-1" tabindex="-1">Test Example <a class="header-anchor" href="#test-example-1" aria-label="Permalink to &quot;Test Example&quot;">​</a></h4><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./buildvm_extraip.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">152</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">oneclick123</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">debian12</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">local</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">N</span></span></code></pre></div><p>The above command is used to create a virtual machine with a dedicated IPv4 address.</p><table><thead><tr><th>Attribute</th><th>Value</th></tr></thead><tbody><tr><td>VMID</td><td>152</td></tr><tr><td>Username</td><td>test1</td></tr><tr><td>Password</td><td>oneclick123</td></tr><tr><td>CPU</td><td>1 core</td></tr><tr><td>Memory</td><td>1024MB</td></tr><tr><td>Disk</td><td>10GB</td></tr><tr><td>OS</td><td>debian12</td></tr><tr><td>Storage</td><td>local disk</td></tr><tr><td>IPv6 Addon</td><td>Not attached by default</td></tr></tbody></table><h3 id="version-requiring-manual-specification-of-ipv4-address" tabindex="-1">Version Requiring Manual Specification of IPV4 Address <a class="header-anchor" href="#version-requiring-manual-specification-of-ipv4-address" aria-label="Permalink to &quot;Version Requiring Manual Specification of IPV4 Address&quot;">​</a></h3><ul><li>Manual specification of IPV4 address with subnet length in the command is required.</li><li>If the host machine comes with an IPV6 subnet, you can choose whether to add an IPV6 address additionally.</li><li>If the vendor has provided an IPV4 address and subnet length, please carefully compare and write the parameters in the command format shown below.</li><li>Relevant system information will be stored in the NOTE of the corresponding virtual machine and can be viewed on the WEB end.</li><li>Optionally enable or disable standalone IPV6, requires the host to have at least one /64 subnet.</li></ul><h4 id="usage-instructions-2" tabindex="-1">Usage Instructions <a class="header-anchor" href="#usage-instructions-2" aria-label="Permalink to &quot;Usage Instructions&quot;">​</a></h4><p><strong>Download Script</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/spiritLHLS/pve/main/scripts/buildvm_manual_ip.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildvm_manual_ip.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildvm_manual_ip.sh</span></span></code></pre></div><p><strong>Meaning of each parameter</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./buildvm_manual_ip.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">VMID</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">USERNAME</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">PASSWORD</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CPU_CORES</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">MEMORY_SIZE_GB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">STORAGE_SIZE_GB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">OS</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">STORAGE_DISK</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">IPV4_ADDRESS</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ATTACH_IPV6</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">defaults</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">to</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">N</span><span style="color:#89DDFF;">)</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note that the PASSWORD here should be a mix of English and numbers only, and start with English, so as to avoid failing to set the PASSWORD due to special characters being escaped during the setup process.</p></div><h4 id="test-example-2" tabindex="-1">Test Example <a class="header-anchor" href="#test-example-2" aria-label="Permalink to &quot;Test Example&quot;">​</a></h4><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./buildvm_manual_ip.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">152</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">oneclick123</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">debian12</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">local</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">a.b.c.d/24</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">N</span></span></code></pre></div><p>The above command is used to create a virtual machine with an independent IPV4 address.</p><table><thead><tr><th>Attribute</th><th>Value</th></tr></thead><tbody><tr><td>VMID</td><td>152</td></tr><tr><td>Username</td><td>test1</td></tr><tr><td>Password</td><td>oneclick123</td></tr><tr><td>CPU</td><td>1 core</td></tr><tr><td>Memory</td><td>1024MB</td></tr><tr><td>Disk</td><td>10GB</td></tr><tr><td>Operating System</td><td>debian12</td></tr><tr><td>Storage Disk</td><td>Local Disk (System Disk)</td></tr><tr><td>IPV4 Address</td><td>a.b.c.d</td></tr><tr><td>Subnet</td><td>/24 Subnet</td></tr><tr><td>IPV6</td><td>None</td></tr></tbody></table><h2 id="creating-virtual-machines-with-pure-ipv6-addresses" tabindex="-1">Creating Virtual Machines with Pure IPv6 Addresses <a class="header-anchor" href="#creating-virtual-machines-with-pure-ipv6-addresses" aria-label="Permalink to &quot;Creating Virtual Machines with Pure IPv6 Addresses&quot;">​</a></h2><p>The prerequisite is that the host provides an IPv6 subnet instead of just a standalone IPv6 address, and the host does not have MAC address verification enabled.</p><h3 id="automatic-selection-of-ipv6-addresses-without-manual-specification" tabindex="-1">Automatic Selection of IPv6 Addresses without Manual Specification <a class="header-anchor" href="#automatic-selection-of-ipv6-addresses-without-manual-specification" aria-label="Permalink to &quot;Automatic Selection of IPv6 Addresses without Manual Specification&quot;">​</a></h3><ul><li>Pure IPV6 refers to a bound public IPV6 address, where the actual VM still has the host&#39;s IPV4 network but no external IPV4 port</li><li>Automatically detect available IPv6 ranges and bind the corresponding V6 address, based on the virtual machine&#39;s number, to the virtual machine.</li><li>System-related information will be stored in the NOTES section of the respective virtual machine, accessible for viewing on the web interface.</li></ul><h4 id="usage-instructions-3" tabindex="-1">Usage Instructions <a class="header-anchor" href="#usage-instructions-3" aria-label="Permalink to &quot;Usage Instructions&quot;">​</a></h4><p><strong>Download Script</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">curl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-L</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">https://raw.githubusercontent.com/spiritLHLS/pve/main/scripts/buildvm_onlyv6.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-o</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildvm_onlyv6.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">chmod</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">+x</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">buildvm_onlyv6.sh</span></span></code></pre></div><p><strong>Meaning of each parameter</strong></p><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./buildvm_onlyv6.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">VMID</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">username</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">password</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">CPU_cores</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">memory_GB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">disk_GB</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">operating_system</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">storage_disk</span></span></code></pre></div><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Note that the password here should be a mix of English and numbers only, and start with English, so as to avoid failing to set the password due to special characters being escaped during the setup process.</p></div><h4 id="test-example-3" tabindex="-1">Test Example <a class="header-anchor" href="#test-example-3" aria-label="Permalink to &quot;Test Example&quot;">​</a></h4><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">./buildvm_onlyv6.sh</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">152</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">test1</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">oneclick123</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1024</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">debian12</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">local</span></span></code></pre></div><p>The above command is used to create a virtual machine with only IPv6 addresses.</p><table><thead><tr><th>Parameter</th><th>Value</th></tr></thead><tbody><tr><td>VMID</td><td>152</td></tr><tr><td>Username</td><td>test1</td></tr><tr><td>Password</td><td>oneclick123</td></tr><tr><td>CPU</td><td>1 core</td></tr><tr><td>Memory</td><td>1024MB</td></tr><tr><td>Disk</td><td>10GB</td></tr><tr><td>Operating System</td><td>debian12</td></tr><tr><td>Storage Disk</td><td>local</td></tr></tbody></table><h3 id="delete-example-vm152" tabindex="-1">Delete Example vm152 <a class="header-anchor" href="#delete-example-vm152" aria-label="Permalink to &quot;Delete Example vm152&quot;">​</a></h3><div class="language-shell"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#FFCB6B;">qm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">stop</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">152</span></span>
<span class="line"><span style="color:#FFCB6B;">qm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">destroy</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">152</span></span>
<span class="line"><span style="color:#FFCB6B;">systemctl</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">restart</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">ndpresponder.service</span></span>
<span class="line"><span style="color:#FFCB6B;">rm</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">-rf</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">vm152</span></span></code></pre></div>`,106),l=[o];function p(r,i,c,d,h,C){return a(),e("div",null,l)}const m=s(n,[["render",p]]);export{y as __pageData,m as default};
